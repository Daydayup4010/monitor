<!-- 我的页面 -->
<view class="my-page">
  <!-- 未登录状态 -->
  <block wx:if="{{!isLoggedIn}}">
    <view class="guest-card">
      <image class="guest-avatar" src="/images/avatar.png"></image>
      <text class="guest-text">登录后享受更多功能</text>
      <button class="login-btn" bindtap="goLogin">微信登录</button>
    </view>

    <!-- 功能预览 -->
    <view class="menu-list">
      <view class="menu-item disabled">
        <text class="label">个人设置</text>
        <text class="lock">🔒</text>
      </view>
      <view class="menu-item disabled">
        <text class="label">绑定邮箱</text>
        <text class="lock">🔒</text>
      </view>
      <button class="menu-item contact-btn" open-type="contact">
        <text class="label">联系客服</text>
        <text class="arrow">></text>
      </button>
    </view>
  </block>

  <!-- 已登录状态 -->
  <block wx:else>
    <!-- 用户信息卡片 -->
    <view class="user-card">
      <view class="user-info">
        <image class="avatar" src="/images/avatar.png"></image>
        <view class="info">
          <text class="username">{{userInfo.username}}</text>
          <text class="email" wx:if="{{userInfo.email}}">{{userInfo.email}}</text>
          <text class="email" wx:else>未绑定邮箱</text>
        </view>
      </view>
      <!-- VIP状态区域 -->
      <view class="vip-status-row">
        <view class="vip-badge {{isVipValid ? 'active' : ''}}" bindtap="goVip" wx:if="{{vipEnabled}}">
          <text wx:if="{{isVipValid}}">VIP会员</text>
          <text wx:else>开通VIP</text>
        </view>
        <view class="vip-badge active" wx:elif="{{isVipValid}}">
          <text>VIP会员</text>
        </view>
        <!-- VIP到期时间 -->
        <text class="vip-expiry" wx:if="{{isVipValid && vipExpiryText}}">到期：{{vipExpiryText}}</text>
      </view>
    </view>

    <!-- VIP入口 - 仅VIP开关开启且非VIP用户显示 -->
    <view class="vip-entry" bindtap="goVip" wx:if="{{vipEnabled && userInfo.role !== 1}}">
      <view class="vip-entry-left">
        <image class="vip-entry-icon" src="/images/vip.png"></image>
        <view class="vip-entry-info">
          <text class="vip-entry-title">开通VIP会员</text>
          <text class="vip-entry-desc">解锁全部功能，查看完整数据</text>
        </view>
      </view>
      <text class="vip-entry-arrow">></text>
    </view>

    <!-- 功能列表 -->
    <view class="menu-list">
      <view class="menu-item" bindtap="goSettings">
        <text class="label">个人设置</text>
        <text class="arrow">></text>
      </view>
      <view class="menu-item" wx:if="{{!userInfo.email}}" bindtap="goBindEmail">
        <text class="label">绑定邮箱</text>
        <text class="arrow">></text>
      </view>
      <button class="menu-item contact-btn" open-type="contact">
        <text class="label">联系客服</text>
        <text class="arrow">></text>
      </button>
      <view class="menu-item" bindtap="logout">
        <text class="label">退出登录</text>
        <text class="arrow">></text>
      </view>
    </view>
  </block>
</view>

